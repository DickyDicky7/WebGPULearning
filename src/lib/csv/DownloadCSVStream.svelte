<!--<script lang="ts"> import { createCsvStreamWorker, type CsvStreamWorker, } from "./csvStreamWorkerWrapper"; let progress: number = $state(0); let total: number = $state(100000); let generating: boolean = $state(false); async function onDownload(): Promise<void> { generating = true; progress = 0; const worker: CsvStreamWorker = createCsvStreamWorker(); worker.onProgress = (written) => (progress = written); worker.init(["id", "name", "email"]); const batchSize: number = 5000; for (let i: number = 0; i < total; i += batchSize) { const rows: { id: number; name: string; email: string; }[] = Array.from( { length: Math.min(batchSize, total - i) }, (_, j) => { const id = i + j + 1; return { id, name: `User ${id}`, email: `user${id}@mail.com`, }; }, ); worker.writeChunk(rows); /* yield a frame to keep UI responsive */ await new Promise(requestAnimationFrame); } const { blobUrl, totalRows } = await worker.end(); const a: HTMLAnchorElement = document.createElement("a"); a.href = blobUrl; a.download = "large_streamed.csv"; a.click(); URL.revokeObjectURL(blobUrl); worker.terminate(); generating = false; alert(`Done! ${totalRows} rows written.`); } </script> <button onclick={onDownload} disabled={generating}> {generating ? `Generating ${progress}/${total}...` : "Download CSV (Streamed Worker)"} </button>-->
    <script lang="ts"> import { createCsvStreamWorker, type CsvStreamWorker, } from "./csvStreamWorkerWrapper"; let progress: number = $state(0); let total: number = $state(100000); let generating: boolean = $state(false); async function onDownload(): Promise<void> { generating = true; progress = 0; const worker: CsvStreamWorker = createCsvStreamWorker(); worker.onProgress = (written) => (progress = written); worker.init(["id", "name", "email"]); const batchSize: number = 5000; for (let i: number = 0; i < total; i += batchSize) { const rows: { id: number; name: string; email: string; }[] = Array.from( { length: Math.min(batchSize, total - i) }, (_, j) => { const id = i + j + 1; return { id, name: `User ${id}`, email: `user${id}@mail.com`, }; }, ); worker.writeChunk(rows); /* yield a frame to keep UI responsive */ await new Promise(requestAnimationFrame); } const { blobUrl, totalRows } = await worker.end(); const a: HTMLAnchorElement = document.createElement("a"); a.href = blobUrl; a.download = "large_streamed.csv"; a.click(); URL.revokeObjectURL(blobUrl); worker.terminate(); generating = false; alert(`Done! ${totalRows} rows written.`); } </script> <button onclick={onDownload} disabled={generating}> {generating ? `Generating ${progress}/${total}...` : "Download CSV (Streamed Worker)"} </button>
<!--<script lang="ts"> import { createCsvStreamWorker, type CsvStreamWorker, } from "./csvStreamWorkerWrapper"; let progress: number = $state(0); let total: number = $state(100000); let generating: boolean = $state(false); async function onDownload(): Promise<void> { generating = true; progress = 0; const worker: CsvStreamWorker = createCsvStreamWorker(); worker.onProgress = (written) => (progress = written); worker.init(["id", "name", "email"]); const batchSize: number = 5000; for (let i: number = 0; i < total; i += batchSize) { const rows: { id: number; name: string; email: string; }[] = Array.from( { length: Math.min(batchSize, total - i) }, (_, j) => { const id = i + j + 1; return { id, name: `User ${id}`, email: `user${id}@mail.com`, }; }, ); worker.writeChunk(rows); /* yield a frame to keep UI responsive */ await new Promise(requestAnimationFrame); } const { blobUrl, totalRows } = await worker.end(); const a: HTMLAnchorElement = document.createElement("a"); a.href = blobUrl; a.download = "large_streamed.csv"; a.click(); URL.revokeObjectURL(blobUrl); worker.terminate(); generating = false; alert(`Done! ${totalRows} rows written.`); } </script> <button onclick={onDownload} disabled={generating}> {generating ? `Generating ${progress}/${total}...` : "Download CSV (Streamed Worker)"} </button>-->
